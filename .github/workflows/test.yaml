name: "ðŸ§ª Test"
on:
  push:
    branches:
      - "main"
  pull_request:
  # build weekly at 4:00 AM UTC
  schedule:
    - cron: '0 4 * * 1'

jobs:
  test:
    name: "${{ matrix.name }}"
    strategy:
      fail-fast: false
      matrix:
        include:
          - name: "Linux"
            runner: "ubuntu-latest"
            cpythons:
              - "3.9"
              - "3.10"
              - "3.11"
              - "3.12"
              - "3.13"
            tox-post-environments:
              - "py3.9-mindeps"
              - "cov-report-ci"
            cache-key-prefix: "linux"
            cache-key-hash-files:
              - "pyproject.toml"

          - name: "macOS"
            runner: "macos-latest"
            cpythons:
              - "3.13"
            tox-post-environments:
              - "cov-report-ci"
            tox-environments-from-pythons: true
            cache-key-prefix: "macos"
            cache-key-hash-files:
              - "pyproject.toml"

          - name: "Windows"
            runner: "windows-latest"
            cpythons:
              - "3.13"
            tox-post-environments:
              - "cov-report-ci"
            tox-environments-from-pythons: true
            cache-key-prefix: "windows"
            cache-key-hash-files:
              - "pyproject.toml"

          - name: "Quality"
            runner: "ubuntu-latest"
            cpythons:
              - "3.10"
              - "3.13"
            tox-environments:
              - "mypy-minpython"
              - "mypy-maxpython"
              - "reference"
              - "check-min-python-is-tested"
              - "twine-check"
              - "twine-check-minimum"
              - "check-sdist"
              - "check-sdist-minimum"
            cache-key-prefix: "quality"
            cache-files:
              - ".mypy_cache/"
            cache-key-hash-files:
              - "pyproject.toml"

    uses: "globus/workflows/.github/workflows/tox.yaml@9cb0a9d3c117062037aefaaa816116e9db1f241f" # v1.4
    with:
      config: "${{ toJSON(matrix) }}"
